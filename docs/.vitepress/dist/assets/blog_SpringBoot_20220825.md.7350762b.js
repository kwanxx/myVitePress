import{_ as s,c as n,o as a,a as l}from"./app.c2dd8913.js";var p="/assets/image-20220825180943813.2b66abbd.png";const d=JSON.parse('{"title":"\u62E6\u622A\u5668","description":"","frontmatter":{},"headers":[{"level":3,"title":"\u62E6\u622A\u5668","slug":"\u62E6\u622A\u5668"}],"relativePath":"blog/SpringBoot/20220825.md","lastUpdated":1673525820000}'),o={name:"blog/SpringBoot/20220825.md"},e=l('<h3 id="\u62E6\u622A\u5668" tabindex="-1">\u62E6\u622A\u5668 <a class="header-anchor" href="#\u62E6\u622A\u5668" aria-hidden="true">#</a></h3><h4 id="_1-\u5E94\u7528\u573A\u666F" tabindex="-1">1.\u5E94\u7528\u573A\u666F <a class="header-anchor" href="#_1-\u5E94\u7528\u573A\u666F" aria-hidden="true">#</a></h4><ul><li>\u6743\u9650\u8BF7\u6C42\uFF1A\u62E6\u622A\u7528\u6237\u8BF7\u6C42\uFF0C\u4F8B\u5982\u68C0\u67E5\u7528\u6237\u662F\u5426\u5DF2\u7ECF\u767B\u9646\u3002</li><li>\u6027\u80FD\u76D1\u63A7\uFF1A\u8BB0\u5F55\u6574\u4E2A\u8BF7\u6C42\u5904\u7406\u7684\u65F6\u95F4\u3002preHandler\u8BB0\u5F55\u5F00\u59CB\u65F6\u95F4\uFF0CafterCompletion\u8BB0\u5F55\u7ED3\u675F\u65F6\u95F4\u3002</li><li>\u65E5\u5FD7\u8BB0\u5F55</li><li>\u901A\u7528\u884C\u4E3A\uFF1A\u8BFB\u53D6\u7528\u6237cookie\u4FE1\u606F\uFF08preHanlder\u8FD9\u91CC\u8BFB\uFF09\uFF0C\u653E\u5165request\u8BF7\u6C42\uFF0C\u65B9\u4FBF\u540E\u7EED\u64CD\u4F5C</li></ul><h4 id="_2-\u5B9E\u73B0\u6D41\u7A0B" tabindex="-1">2.\u5B9E\u73B0\u6D41\u7A0B <a class="header-anchor" href="#_2-\u5B9E\u73B0\u6D41\u7A0B" aria-hidden="true">#</a></h4><p><img src="'+p+`" alt="image-20220825180943813"></p><div class="language-"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">st=&gt;start: \u53D1\u8D77\u8BF7\u6C42</span></span>
<span class="line"><span style="color:#A6ACCD;">op=&gt;operation: preHandler\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#A6ACCD;">cond=&gt;condition: \u662F\u5426\u7B26\u5408\u8FC7\u6EE4\u6761\u4EF6\uFF1F</span></span>
<span class="line"><span style="color:#A6ACCD;">op2=&gt;operation: \u8FDB\u5165Controller</span></span>
<span class="line"><span style="color:#A6ACCD;">op3=&gt;operation: postHandler</span></span>
<span class="line"><span style="color:#A6ACCD;">op4=&gt;operation: afterCompletion</span></span>
<span class="line"><span style="color:#A6ACCD;">e=&gt;end: \u7ED3\u675F</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">st-&gt;op-&gt;cond</span></span>
<span class="line"><span style="color:#A6ACCD;">cond(yes)-&gt;op2-&gt;op3-&gt;op4-&gt;e</span></span>
<span class="line"><span style="color:#A6ACCD;">cond(no)-&gt;e</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h4 id="_3-\u5B9E\u73B0\u4EE3\u7801" tabindex="-1">3.\u5B9E\u73B0\u4EE3\u7801 <a class="header-anchor" href="#_3-\u5B9E\u73B0\u4EE3\u7801" aria-hidden="true">#</a></h4><p>\u9700\u8981\u5728\u63A7\u5236\u53F0\u663E\u793A\u4FE1\u606F\uFF1A\u8FD9\u91CC\u8981\u7528Log4j2\u6846\u67B6\u8BB0\u5F55\u65E5\u5FD7\uFF0C\u5148\u5230pom.xml\uFF0C\u6DFB\u52A0Log4j2 dependency\uFF1A</p><div class="language-xml"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dependencies</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- \u590D\u5236\u8FD9\u91CC\u5F00\u59CB--&gt;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dependency</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">org.springframework.boot</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">spring-boot-starter-log4j2</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">dependency</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">&lt;!-- \u590D\u5236\u8FD9\u91CC\u7ED3\u675F--&gt;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">dependencies</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u81EA\u5B9A\u4E49HandlerIncerceptor\u7C7B\uFF1A\u5728src/main/java/com.yourpackage.demo/handler\uFF0C\u5EFA\u7ACB\u5B9E\u73B0HandlerInterceptor\u63A5\u53E3\u7684\u81EA\u5B9A\u4E49HandlerIncerceptor\u7C7B\uFF1A</p><div class="language-java"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * \u81EA\u5B9A\u4E49HandlerInterceptor\u7C7B</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Component</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestInterceptor</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">HandlerInterceptor</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">Logger</span><span style="color:#A6ACCD;"> log </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> LoggerFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getLogger</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">getClass</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">preHandle</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">HttpServletRequest</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HttpServletResponse</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Object</span><span style="color:#A6ACCD;"> handler</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">       log</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.\u8FD9\u4E00\u6B65\u662F\uFF1ApreHandle</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//\u4ECE\u8FD9\u91CC\u5F00\u59CB\uFF0C\u5982\u679C\u5224\u65AD\u662Ftrue\uFF0C\u76F4\u63A5\u8FDB\u51652.controller</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">postHandle</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">HttpServletRequest</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HttpServletResponse</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Object</span><span style="color:#A6ACCD;"> handler</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ModelAndView</span><span style="color:#A6ACCD;"> modelAndView</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        log</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3.\u8FD9\u4E00\u6B65\u662F\uFF1ApostHandle</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">afterCompletion</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">HttpServletRequest</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HttpServletResponse</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Object</span><span style="color:#A6ACCD;"> handler</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> ex</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        log</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">4.\u8FD9\u4E00\u6B65\u662F\uFF1AafterCompletion</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u5B9E\u73B0WebConfigurer\u63A5\u53E3\uFF0C\u5728src/main/java/com.yourpackage.demo/config\uFF0C\u7528\u4E8E\u5EFA\u7ACB\u81EA\u5B9A\u4E49\u7684WebConfigurer\uFF1A</p><div class="language-java"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Configuration</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebConfigurer</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebMvcConfigurer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Autowired</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">TestInterceptor</span><span style="color:#A6ACCD;"> testInterceptor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">addInterceptors</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterceptorRegistry</span><span style="color:#A6ACCD;"> registry</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        WebMvcConfigurer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addInterceptors</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">registry</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        registry</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addInterceptor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">testInterceptor</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">addPathPatterns</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/**</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//addPathPatterns\u65B9\u6CD5\u662F\u8FC7\u6EE4\u5668\u5E94\u7528\u5728\u54EA\u4E2A\u9875\u9762</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div>`,13),t=[e];function r(c,y,D,A,C,F){return a(),n("div",null,t)}var g=s(o,[["render",r]]);export{d as __pageData,g as default};
